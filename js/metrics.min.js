(()=>{if(document.getElementById&&document.getElementById('perf-panel'))return;const e={fcp:null,lcp:null,cls:0,clsEntries:[],longTasks:0,longTasksTime:0,totalBlockingTime:0,resources:[],totalRequests:0,totalBytes:0,nav:null},t=v=>v==null?"-":Math.round(v)+" ms",n=v=>v==null?"-":(v/1024).toFixed(1)+" KB";try{const r=new PerformanceObserver((r=>{for(const o of r.getEntries())"first-contentful-paint"===o.name&&e.fcp==null&&(e.fcp=o.startTime,update(),r.disconnect())}));r.observe({type:"paint",buffered:!0})}catch(o){}try{const r=new PerformanceObserver((r=>{for(const o of r.getEntries())e.lcp=o.renderTime||o.loadTime||o.startTime;update()}));r.observe({type:"largest-contentful-paint",buffered:!0}),addEventListener("visibilitychange",(()=>{"hidden"===document.visibilityState&&r.takeRecords()}))}catch(o){}try{const r=new PerformanceObserver((r=>{for(const o of r.getEntries())o.hadRecentInput||([e.cls+=o.value,e.clsEntries.push(o)]);update()}));r.observe({type:"layout-shift",buffered:!0})}catch(o){}try{const r=new PerformanceObserver((r=>{for(const o of r.getEntries())e.longTasks++,e.longTasksTime+=o.duration,e.totalBlockingTime+=Math.max(0,o.duration-50);update()}));r.observe({entryTypes:["longtask"]})}catch(o){}function collectResources(){const r=performance.getEntriesByType("resource");e.resources=r,e.totalRequests=r.length+1;let o=0;for(const a of r){const s=(a.transferSize&&a.transferSize>0)?a.transferSize:(a.encodedBodySize||0);o+=s}e.totalBytes=o}function collectNavigation(){const r=performance.getEntriesByType("navigation")[0];r&&(e.nav=r)}const panel=document.createElement("div");panel.setAttribute("id","perf-panel"),Object.assign(panel.style,{position:"fixed",right:"16px",bottom:"16px",zIndex:9999,width:"320px",maxWidth:"90vw",fontFamily:"ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial",background:"rgba(10,12,28,.9)",color:"#E8ECF1",border:"1px solid rgba(255,255,255,.12)",borderRadius:"12px",boxShadow:"0 10px 40px rgba(0,0,0,.5)",backdropFilter:"blur(6px) saturate(120%)",padding:"12px 14px"}),panel.innerHTML=`<div style="display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:8px"><strong style="letter-spacing:.2px">Évaluation perfs</strong><div><button id="perf-refresh" style="background:#7C5CFF;color:white;border:0;border-radius:8px;padding:6px 10px;cursor:pointer">Mesurer</button><button id="perf-close" style="background:transparent;color:#c9d1d9;border:1px solid rgba(255,255,255,.2);border-radius:8px;padding:6px 8px;margin-left:6px;cursor:pointer">×</button></div></div><div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;font-size:13px"><div><div style="opacity:.8">FCP</div><div id="m-fcp" style="font-weight:600">-</div></div><div><div style="opacity:.8">LCP</div><div id="m-lcp" style="font-weight:600">-</div></div><div><div style="opacity:.8">CLS</div><div id="m-cls" style="font-weight:600">-</div></div><div><div style="opacity:.8">TBT (≈)</div><div id="m-tbt" style="font-weight:600">-</div></div><div><div style="opacity:.8">Requêtes</div><div id="m-req" style="font-weight:600">-</div></div><div><div style="opacity:.8">Poids total</div><div id="m-bytes" style="font-weight:600">-</div></div></div><div style="margin-top:8px;font-size:12px;opacity:.8"><div id="m-note">Cliquez sur <em>Mesurer</em> après vos modifications.</div></div>`,document.addEventListener("DOMContentLoaded",(()=>{document.body.appendChild(panel)}));function update(){collectResources(),collectNavigation();const r=a=>panel.querySelector(a);r("#m-fcp").textContent=t(e.fcp),r("#m-lcp").textContent=t(e.lcp),r("#m-cls").textContent=e.cls?e.cls.toFixed(3):"-",r("#m-tbt").textContent=e.totalBlockingTime?t(e.totalBlockingTime):"-",r("#m-req").textContent=String(e.totalRequests||"-"),r("#m-bytes").textContent=e.totalBytes?n(e.totalBytes):"-",window.__metrics={fcp:e.fcp,lcp:e.lcp,cls:e.cls,tbtApprox:e.totalBlockingTime,totalRequests:e.totalRequests,totalBytes:e.totalBytes,navigation:e.nav}}document.addEventListener("click",(e=>{e.target&&"perf-refresh"===e.target.id&&update(),e.target&&"perf-close"===e.target.id&&panel.remove()})),addEventListener("load",(()=>{setTimeout(update,0)}));})();
